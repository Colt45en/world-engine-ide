#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npm run typecheck
npm run build

# Run Python tests only when a repo-local venv exists and has pytest.
if [ -x ".venv/Scripts/python.exe" ] || [ -x ".venv/bin/python" ]; then
	if node scripts/run-python.cjs -c "import pytest" >/dev/null 2>&1; then
		echo "Running Python tests (pytest)..."
		if ! node scripts/run-python.cjs -m pytest -q; then
			echo "Python tests failed; continuing push"
		fi
	else
		echo "Skipping Python tests: pytest not installed in .venv"
	fi
else
	echo "Skipping Python tests: .venv not found"
fi
