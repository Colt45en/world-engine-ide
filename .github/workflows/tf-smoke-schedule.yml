name: TF weekly smoke

on:
  schedule:
    - cron: '0 3 * * 1' # At 03:00 UTC every Monday
  workflow_dispatch: {}

jobs:
  run-tf-smoke:
    name: TF smoke (scheduled)
    runs-on: ubuntu-latest
    container:
      image: tensorflow/tensorflow:2.12.0
      options: --user root:root

    steps:
      - uses: actions/checkout@v4

      - name: Show Python and TensorFlow info
        run: |
          python -V
          python -c "import tensorflow as tf; print('TF', tf.__version__)"

      - name: Install non-TF requirements
        run: |
          python -m pip install --upgrade pip
          if [ -f brain/requirements.txt ]; then grep -v -i "^tensorflow" brain/requirements.txt > /tmp/reqs || true; pip install -r /tmp/reqs || true; fi
          pip install pytest

      - name: Run TF-dependent smoke test
        run: |
          pytest -q brain/tests/test_training_smoke.py
